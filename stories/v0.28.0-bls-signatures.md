# Story: v0.28.0 BLS Signatures

> BLS12-381 signature types for Solana consensus and validator operations

## 目标

实现 BLS (Boneh-Lynn-Shacham) 签名模块，提供 BLS12-381 曲线上的签名类型定义。
这些类型主要用于 Solana 验证器共识机制。

**注意**: 此模块仅提供链上可用的字节表示类型。实际的密钥生成、签名和验证操作
需要在链下进行（使用 Rust SDK 或其他 BLS 库）。

## Rust 源码参考

- https://github.com/anza-xyz/solana-sdk/tree/master/bls-signatures
- 主要文件:
  - `src/lib.rs` - 模块导出
  - `src/error.rs` - BlsError 错误类型
  - `src/pubkey/bytes.rs` - 公钥字节类型
  - `src/signature/bytes.rs` - 签名字节类型
  - `src/proof_of_possession/bytes.rs` - 所有权证明类型

## 验收标准

### 常量定义

- [x] `BLS_PUBLIC_KEY_COMPRESSED_SIZE` = 48
- [x] `BLS_PUBLIC_KEY_AFFINE_SIZE` = 96
- [x] `BLS_SIGNATURE_COMPRESSED_SIZE` = 96
- [x] `BLS_SIGNATURE_AFFINE_SIZE` = 192
- [x] `BLS_PROOF_OF_POSSESSION_COMPRESSED_SIZE` = 96
- [x] `BLS_PROOF_OF_POSSESSION_AFFINE_SIZE` = 192
- [x] `POP_DST` 域分离标签

### 错误类型 (BlsError)

- [x] `FieldDecode` - 字段解码失败
- [x] `EmptyAggregation` - 空聚合尝试
- [x] `KeyDerivation` - 密钥派生失败
- [x] `PointConversion` - 点表示转换失败
- [x] `ParseFromString` - 字符串解析失败
- [x] `ParseFromBytes` - 字节解析失败
- [x] `InputLengthMismatch` - 输入长度不匹配

### 公钥类型 (Pubkey)

- [x] `Pubkey` - 96 字节仿射表示
- [x] `PubkeyCompressed` - 48 字节压缩表示
- [x] `new()` 构造函数
- [x] `default()` 零值
- [x] `toBytes()` 转换为字节
- [x] `equals()` 相等比较
- [x] `isZero()` 零值检查
- [x] `format()` Base64 格式化输出

### 签名类型 (Signature)

- [x] `Signature` - 192 字节仿射表示
- [x] `SignatureCompressed` - 96 字节压缩表示
- [x] `new()` 构造函数
- [x] `default()` 零值
- [x] `toBytes()` 转换为字节
- [x] `equals()` 相等比较
- [x] `isZero()` 零值检查
- [x] `format()` Base64 格式化输出

### 所有权证明类型 (ProofOfPossession)

- [x] `ProofOfPossession` - 192 字节仿射表示
- [x] `ProofOfPossessionCompressed` - 96 字节压缩表示
- [x] `new()` 构造函数
- [x] `default()` 零值
- [x] `toBytes()` 转换为字节
- [x] `equals()` 相等比较
- [x] `isZero()` 零值检查
- [x] `format()` Base64 格式化输出

### 集成

- [x] root.zig 导出
- [x] 单元测试通过
- [x] ROADMAP.md 更新到 100%

## 技术说明

### BLS12-381 曲线

BLS12-381 是一种配对友好的椭圆曲线，广泛用于：
- 阈值签名
- 聚合签名
- 零知识证明

### 类型大小说明

| 类型 | 压缩大小 | 仿射大小 | 说明 |
|------|----------|----------|------|
| 公钥 | 48 bytes | 96 bytes | G1 点 |
| 签名 | 96 bytes | 192 bytes | G2 点 |
| PoP | 96 bytes | 192 bytes | G2 点 |

### 链上限制

在 Solana 链上程序中：
- 只能存储和传输字节表示
- 不能进行密钥生成（需要链下）
- 不能进行签名操作（需要链下）
- 不能进行验证操作（需要链下或预编译）

## 完成状态

- 开始日期: 2026-01-06
- 完成日期: 2026-01-06
- 状态: ✅ 已完成
