# Story: v0.27.0 Vote Program Interface

> 实现 vote-interface 模块，提供投票程序接口支持

## 目标

- [x] 实现 `vote_interface.zig` - Vote 程序接口
- [x] 提供核心投票类型 (VoteInit, Vote, Lockout 等)
- [x] 提供 VoteError 错误类型
- [x] 提供 VoteInstruction 指令枚举
- [x] 提供授权相关类型 (VoteAuthorize)
- [x] 提供指令构建函数

## 验收标准

### vote_interface.zig

- [x] Rust 源引用注释 (vote-interface crate)
- [x] Program ID 常量 (Vote111111111111111111111111111111111111111)
- [x] 常量定义:
  - [x] MAX_LOCKOUT_HISTORY (31)
  - [x] INITIAL_LOCKOUT (2)
  - [x] MAX_EPOCH_CREDITS_HISTORY (64)
  - [x] VOTE_CREDITS_GRACE_SLOTS (2)
  - [x] VOTE_CREDITS_MAXIMUM_PER_SLOT (16)
  - [x] BLS_PUBLIC_KEY_COMPRESSED_SIZE (48)
  - [x] BLS_PROOF_OF_POSSESSION_COMPRESSED_SIZE (96)
- [x] 核心类型:
  - [x] `Lockout` 结构体 - slot, confirmation_count
  - [x] `LandedVote` 结构体 - latency, lockout
  - [x] `Vote` 结构体 - slots, hash, timestamp
  - [x] `VoteInit` 结构体 - node_pubkey, authorized_voter, authorized_withdrawer, commission
  - [x] `VoteAuthorize` 枚举 - Voter, Withdrawer
  - [x] `CommissionKind` 枚举 - InflationRewards, BlockRevenue
- [x] `VoteError` 错误类型 (21 种错误)
- [x] `VoteInstruction` 指令枚举 (基础变体)
- [x] 指令构建函数:
  - [x] `initializeAccount` - 初始化投票账户
  - [x] `authorize` - 授权投票者或提款者
  - [x] `withdraw` - 提款
  - [x] `updateValidatorIdentity` - 更新验证者身份
  - [x] `updateCommission` - 更新佣金
  - [x] `createAccount` - 创建并初始化投票账户

### 测试

- [x] Lockout 创建和计算测试
- [x] Vote 创建测试
- [x] VoteInit 序列化测试
- [x] VoteError from u32 / to string 测试
- [x] Program ID 验证测试
- [x] 指令构建测试 (authorize, withdraw, updateCommission, etc.)
- [x] createAccount 指令序列测试

### 集成

- [x] root.zig 导出模块
- [x] 所有测试通过 (zig build test) - 336 tests passed
- [x] Native Programs 达到 100% 覆盖率 (12/12)

## 技术说明

### Rust 源码

- lib.rs: https://github.com/anza-xyz/solana-sdk/blob/master/vote-interface/src/lib.rs
- instruction.rs: https://github.com/anza-xyz/solana-sdk/blob/master/vote-interface/src/instruction.rs
- error.rs: https://github.com/anza-xyz/solana-sdk/blob/master/vote-interface/src/error.rs
- state/mod.rs: https://github.com/anza-xyz/solana-sdk/blob/master/vote-interface/src/state/mod.rs
- state/vote_instruction_data.rs: https://github.com/anza-xyz/solana-sdk/blob/master/vote-interface/src/state/vote_instruction_data.rs

### 核心类型

```zig
/// Vote 锁定
pub const Lockout = struct {
    slot: u64,
    confirmation_count: u32,
};

/// Vote 初始化参数
pub const VoteInit = struct {
    node_pubkey: PublicKey,
    authorized_voter: PublicKey,
    authorized_withdrawer: PublicKey,
    commission: u8,
};

/// Vote 授权类型
pub const VoteAuthorize = enum(u8) {
    Voter = 0,
    Withdrawer = 1,
};
```

### 依赖

- `public_key.zig` - PublicKey 类型
- `hash.zig` - Hash 类型
- `instruction.zig` - AccountMeta 构建
- `system_program.zig` - System 程序指令 (create_account)
- `clock.zig` - Clock sysvar
- `rent.zig` - Rent sysvar

### 复杂度说明

vote-interface 是 Solana SDK 中最复杂的模块之一，包含：
- 21 种错误类型
- 20+ 种指令变体
- 多个状态版本 (V1_14_11, V3, V4)
- BLS 签名支持 (VoteInitV2)

本实现专注于核心功能，不包括完整的 VoteState 序列化/反序列化（那是验证者运行时的功能）。

## 完成状态

- 开始日期: 2026-01-06
- 完成日期: 2026-01-06
- 状态: ✅ 已完成
