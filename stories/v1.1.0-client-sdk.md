# Story: v1.1.0 Client SDK å®ç°

> å®ç°å®Œæ•´çš„ Solana RPC Client SDKï¼Œè¦†ç›–æ‰€æœ‰ 52 ä¸ª HTTP RPC æ–¹æ³•

## èƒŒæ™¯

å½“å‰é¡¹ç›®å·²å®Œæˆï¼š
- `sdk/` - å…±äº«æ ¸å¿ƒç±»å‹ï¼ˆæ—  syscall ä¾èµ–ï¼‰
- `src/` - Program SDKï¼ˆå« syscallï¼Œç”¨äºé“¾ä¸Šç¨‹åºï¼‰

ç¼ºå°‘ Client SDKï¼Œæ— æ³•è¿›è¡Œé“¾ä¸‹å¼€å‘ï¼ˆæ„å»ºäº¤æ˜“ã€æŸ¥è¯¢è´¦æˆ·ã€æäº¤äº¤æ˜“ç­‰ï¼‰ã€‚

## ç›®æ ‡

å®ç°ä¸ Rust `solana-rpc-client` å¯¹ç­‰çš„åŠŸèƒ½ï¼š
- 52 ä¸ª HTTP RPC æ–¹æ³•
- `_with_commitment` å˜ä½“
- WebSocket è®¢é˜…ï¼ˆåç»­ï¼‰

## RPC æ–¹æ³•å®Œæ•´åˆ—è¡¨ (52 ä¸ª)

### Account Methods (7)

| æ–¹æ³• | è¯´æ˜ | ä¼˜å…ˆçº§ |
|------|------|--------|
| `getAccountInfo` | æŸ¥è¯¢è´¦æˆ·ä¿¡æ¯ | P0 |
| `getBalance` | æŸ¥è¯¢ä½™é¢ | P0 |
| `getMultipleAccounts` | æ‰¹é‡æŸ¥è¯¢è´¦æˆ· | P1 |
| `getProgramAccounts` | æŸ¥è¯¢ç¨‹åºæ‹¥æœ‰çš„è´¦æˆ· | P1 |
| `getLargestAccounts` | æŸ¥è¯¢æœ€å¤§è´¦æˆ· | P2 |
| `getTokenAccountBalance` | SPL Token ä½™é¢ | P1 |
| `getTokenAccountsByOwner` | æŒ‰æ‰€æœ‰è€…æŸ¥è¯¢ Token è´¦æˆ· | P1 |

### Block Methods (10)

| æ–¹æ³• | è¯´æ˜ | ä¼˜å…ˆçº§ |
|------|------|--------|
| `getBlock` | æŸ¥è¯¢åŒºå—ä¿¡æ¯ | P1 |
| `getBlockHeight` | å½“å‰åŒºå—é«˜åº¦ | P1 |
| `getBlockProduction` | åŒºå—ç”Ÿäº§ä¿¡æ¯ | P2 |
| `getBlockCommitment` | åŒºå—ç¡®è®¤çŠ¶æ€ | P2 |
| `getBlocks` | æŸ¥è¯¢åŒºå—åˆ—è¡¨ | P2 |
| `getBlocksWithLimit` | å¸¦é™åˆ¶çš„åŒºå—åˆ—è¡¨ | P2 |
| `getBlockTime` | åŒºå—æ—¶é—´ | P2 |
| `getFirstAvailableBlock` | æœ€æ—©å¯ç”¨åŒºå— | P2 |
| `getLatestBlockhash` | æœ€æ–°åŒºå—å“ˆå¸Œ | P0 |
| `isBlockhashValid` | éªŒè¯åŒºå—å“ˆå¸Œæœ‰æ•ˆæ€§ | P1 |

### Transaction Methods (9)

| æ–¹æ³• | è¯´æ˜ | ä¼˜å…ˆçº§ |
|------|------|--------|
| `getTransaction` | æŸ¥è¯¢äº¤æ˜“è¯¦æƒ… | P1 |
| `getSignatureStatuses` | æŸ¥è¯¢ç­¾åçŠ¶æ€ | P0 |
| `getSignaturesForAddress` | æŒ‰åœ°å€æŸ¥è¯¢ç­¾å | P1 |
| `getTransactionCount` | äº¤æ˜“è®¡æ•° | P2 |
| `sendTransaction` | å‘é€äº¤æ˜“ | P0 |
| `simulateTransaction` | æ¨¡æ‹Ÿäº¤æ˜“ | P1 |
| `getFeeForMessage` | æ¶ˆæ¯è´¹ç”¨ | P1 |
| `getRecentPrioritizationFees` | ä¼˜å…ˆè´¹ç”¨ | P1 |
| `requestAirdrop` | ç©ºæŠ• (devnet) | P1 |

### Cluster & Node Methods (11)

| æ–¹æ³• | è¯´æ˜ | ä¼˜å…ˆçº§ |
|------|------|--------|
| `getClusterNodes` | é›†ç¾¤èŠ‚ç‚¹ä¿¡æ¯ | P2 |
| `getEpochInfo` | å½“å‰ epoch ä¿¡æ¯ | P1 |
| `getEpochSchedule` | epoch è°ƒåº¦ | P2 |
| `getGenesisHash` | åˆ›ä¸–åŒºå—å“ˆå¸Œ | P2 |
| `getHealth` | èŠ‚ç‚¹å¥åº·çŠ¶æ€ | P1 |
| `getHighestSnapshotSlot` | æœ€é«˜å¿«ç…§ slot | P2 |
| `getIdentity` | èŠ‚ç‚¹èº«ä»½ | P2 |
| `getSlot` | å½“å‰ slot | P1 |
| `getSlotLeader` | å½“å‰ slot leader | P2 |
| `getSlotLeaders` | slot leaders åˆ—è¡¨ | P2 |
| `getVersion` | Solana ç‰ˆæœ¬ | P1 |

### Inflation & Economics (6)

| æ–¹æ³• | è¯´æ˜ | ä¼˜å…ˆçº§ |
|------|------|--------|
| `getInflationGovernor` | é€šèƒ€æ²»ç† | P2 |
| `getInflationRate` | é€šèƒ€ç‡ | P2 |
| `getInflationReward` | é€šèƒ€å¥–åŠ± | P2 |
| `getSupply` | ä¾›åº”é‡ä¿¡æ¯ | P2 |
| `getMinimumBalanceForRentExemption` | ç§Ÿé‡‘è±å…æœ€å°ä½™é¢ | P0 |
| `getStakeMinimumDelegation` | æœ€å°è´¨æŠ¼å§”æ‰˜ | P2 |

### Validator & Voting (3)

| æ–¹æ³• | è¯´æ˜ | ä¼˜å…ˆçº§ |
|------|------|--------|
| `getVoteAccounts` | æŠ•ç¥¨è´¦æˆ· | P2 |
| `getLeaderSchedule` | Leader è°ƒåº¦ | P2 |
| `getRecentPerformanceSamples` | æ€§èƒ½æ ·æœ¬ | P2 |

### Token Methods (SPL) (4)

| æ–¹æ³• | è¯´æ˜ | ä¼˜å…ˆçº§ |
|------|------|--------|
| `getTokenSupply` | Token ä¾›åº”é‡ | P1 |
| `getTokenLargestAccounts` | æœ€å¤§ Token è´¦æˆ· | P2 |
| `getTokenAccountsByDelegate` | æŒ‰å§”æ‰˜æŸ¥è¯¢ | P2 |

### Utility (2)

| æ–¹æ³• | è¯´æ˜ | ä¼˜å…ˆçº§ |
|------|------|--------|
| `minimumLedgerSlot` | æœ€å°è´¦æœ¬ slot | P2 |
| `getMaxRetransmitSlot` | æœ€å¤§é‡ä¼  slot | P2 |

## å®ç°é˜¶æ®µ

### Phase 1: åŸºç¡€è®¾æ–½

```
client/
â”œâ”€â”€ build.zig
â”œâ”€â”€ build.zig.zon
â””â”€â”€ src/
    â”œâ”€â”€ root.zig
    â”œâ”€â”€ error.zig          # ClientError, RpcError
    â”œâ”€â”€ types.zig          # Response, Context, é…ç½®ç±»å‹
    â”œâ”€â”€ commitment.zig     # CommitmentConfig
    â””â”€â”€ json_rpc.zig       # JSON-RPC è¯·æ±‚/å“åº”å¤„ç†
```

### Phase 2: P0 æ ¸å¿ƒæ–¹æ³• (æœ€å°å¯ç”¨)

| æ–¹æ³• | ç”¨é€” |
|------|------|
| `getBalance` | æŸ¥è¯¢ä½™é¢ |
| `getAccountInfo` | æŸ¥è¯¢è´¦æˆ· |
| `getLatestBlockhash` | äº¤æ˜“æ„å»ºå¿…éœ€ |
| `getMinimumBalanceForRentExemption` | åˆ›å»ºè´¦æˆ·å¿…éœ€ |
| `sendTransaction` | å‘é€äº¤æ˜“ |
| `getSignatureStatuses` | ç¡®è®¤äº¤æ˜“ |

### Phase 3: P1 å¸¸ç”¨æ–¹æ³•

| æ–¹æ³• | ç”¨é€” |
|------|------|
| `getMultipleAccounts` | æ‰¹é‡æŸ¥è¯¢ |
| `getProgramAccounts` | æŸ¥è¯¢ç¨‹åºè´¦æˆ· |
| `getTransaction` | äº¤æ˜“è¯¦æƒ… |
| `simulateTransaction` | æ¨¡æ‹Ÿæ‰§è¡Œ |
| `requestAirdrop` | å¼€å‘æµ‹è¯• |
| `getTokenAccountBalance` | SPL Token |
| `getTokenAccountsByOwner` | SPL Token |
| `isBlockhashValid` | åŒºå—å“ˆå¸ŒéªŒè¯ |
| `getEpochInfo` | Epoch ä¿¡æ¯ |
| `getSlot` | å½“å‰ Slot |
| `getHealth` | å¥åº·æ£€æŸ¥ |
| `getVersion` | ç‰ˆæœ¬ä¿¡æ¯ |
| `getFeeForMessage` | è´¹ç”¨ä¼°ç®— |
| `getRecentPrioritizationFees` | ä¼˜å…ˆè´¹ç”¨ |
| `getSignaturesForAddress` | å†å²ç­¾å |
| `getTokenSupply` | Token ä¾›åº”é‡ |
| `getBlock` | åŒºå—ä¿¡æ¯ |
| `getBlockHeight` | åŒºå—é«˜åº¦ |

### Phase 4: P2 å®Œæ•´å®ç°

å‰©ä½™æ‰€æœ‰æ–¹æ³•ï¼Œç¡®ä¿ 52 ä¸ªå…¨éƒ¨è¦†ç›–ã€‚

### Phase 5: ä¾¿æ·æ–¹æ³•

- `_with_commitment` å˜ä½“
- `send_and_confirm_transaction` (å‘é€å¹¶ç­‰å¾…ç¡®è®¤)
- `poll_for_signature` (è½®è¯¢ç­¾åçŠ¶æ€)
- `wait_for_balance` (ç­‰å¾…ä½™é¢å˜åŒ–)

### Phase 6: WebSocket è®¢é˜… (å¯é€‰)

- `accountSubscribe` / `accountUnsubscribe`
- `slotSubscribe` / `slotUnsubscribe`
- `signatureSubscribe` / `signatureUnsubscribe`
- ç­‰ 9 å¯¹è®¢é˜…æ–¹æ³•

## éªŒæ”¶æ ‡å‡†

### Phase 1: åŸºç¡€è®¾æ–½ âœ…
- [x] åˆ›å»º `client/` ç›®å½•ç»“æ„
- [x] å®ç° `error.zig` - ClientError, RpcError
- [x] å®ç° `types.zig` - Response<T>, RpcResponseContext
- [x] å®ç° `commitment.zig` - CommitmentConfig
- [x] å®ç° `json_rpc.zig` - HTTP JSON-RPC å®¢æˆ·ç«¯
- [x] åŸºç¡€æµ‹è¯•é€šè¿‡

### Phase 2: P0 æ ¸å¿ƒ âœ…
- [x] `getBalance`
- [x] `getAccountInfo`
- [x] `getLatestBlockhash`
- [x] `getMinimumBalanceForRentExemption`
- [x] `sendTransaction`
- [x] `getSignatureStatuses`
- [ ] ç«¯åˆ°ç«¯æµ‹è¯• (devnet)

### Phase 3: P1 å¸¸ç”¨ âœ…
- [x] `getMultipleAccounts`
- [x] `getProgramAccounts`
- [x] `getTransaction`
- [x] `simulateTransaction`
- [x] `requestAirdrop`
- [x] `getTokenAccountBalance`
- [x] `getTokenAccountsByOwner`
- [x] `isBlockhashValid`
- [x] `getEpochInfo`
- [x] `getSlot`
- [x] `getHealth`
- [x] `getVersion`
- [x] `getFeeForMessage`
- [x] `getRecentPrioritizationFees`
- [x] `getSignaturesForAddress`
- [x] `getTokenSupply`
- [x] `getBlock`
- [x] `getBlockHeight`
- [x] æµ‹è¯•è¦†ç›–

### Phase 4: P2 å®Œæ•´ âœ…
- [x] å‰©ä½™æ–¹æ³•å®ç°
- [x] 52 ä¸ªæ–¹æ³•å…¨éƒ¨è¦†ç›–
- [x] å®Œæ•´æµ‹è¯•

### Phase 5: ä¾¿æ·æ–¹æ³• âœ…
- [x] `_with_commitment` å˜ä½“ (å·²åœ¨ P0-P2 ä¸­å®ç°)
- [x] `sendAndConfirmTransaction` - å‘é€å¹¶ç­‰å¾…ç¡®è®¤
- [x] `confirmTransaction` - ç­‰å¾…äº¤æ˜“ç¡®è®¤
- [x] `pollForSignatureStatus` - è½®è¯¢ç­¾åçŠ¶æ€
- [x] `getNewBlockhash` - è·å–æ–°çš„åŒºå—å“ˆå¸Œ
- [x] `isHealthy` - æ£€æŸ¥èŠ‚ç‚¹å¥åº·çŠ¶æ€
- [x] `getBalanceInSol` - è·å– SOL ä½™é¢ï¼ˆé lamportsï¼‰

## æŠ€æœ¯è®¾è®¡

### RpcClient ç»“æ„

```zig
pub const RpcClient = struct {
    allocator: std.mem.Allocator,
    endpoint: []const u8,
    commitment: CommitmentConfig,
    http_client: std.http.Client,
    request_id: std.atomic.Value(u64),

    // P0 Methods
    pub fn getBalance(self: *RpcClient, pubkey: PublicKey) !u64;
    pub fn getBalanceWithCommitment(self: *RpcClient, pubkey: PublicKey, commitment: Commitment) !Response(u64);
    pub fn getAccountInfo(self: *RpcClient, pubkey: PublicKey) !?AccountInfo;
    pub fn getLatestBlockhash(self: *RpcClient) !LatestBlockhash;
    pub fn getMinimumBalanceForRentExemption(self: *RpcClient, data_len: usize) !u64;
    pub fn sendTransaction(self: *RpcClient, transaction: []const u8) !Signature;
    pub fn getSignatureStatuses(self: *RpcClient, signatures: []const Signature) ![]?TransactionStatus;
    
    // ... 46 more methods
};
```

### Response ç±»å‹

```zig
pub fn Response(comptime T: type) type {
    return struct {
        context: RpcResponseContext,
        value: T,
    };
}

pub const RpcResponseContext = struct {
    slot: u64,
    api_version: ?[]const u8,
};
```

### é”™è¯¯ç±»å‹

```zig
pub const ClientError = error{
    HttpError,
    JsonParseError,
    RpcError,
    Timeout,
    ConnectionFailed,
    InvalidResponse,
};

pub const RpcErrorInfo = struct {
    code: i64,
    message: []const u8,
    data: ?std.json.Value,
};
```

## æ–¹æ³•ç»Ÿè®¡

| ä¼˜å…ˆçº§ | æ•°é‡ | è¯´æ˜ |
|--------|------|------|
| P0 | 6 | æœ€å°å¯ç”¨ |
| P1 | 18 | å¸¸ç”¨æ–¹æ³• |
| P2 | 28 | å®Œæ•´è¦†ç›– |
| **Total** | **52** | å…¨éƒ¨ HTTP RPC |

## å®ŒæˆçŠ¶æ€

- å¼€å§‹æ—¥æœŸ: 2026-01-06
- å®Œæˆæ—¥æœŸ: -
- å½“å‰çŠ¶æ€: ğŸ”¨ è¿›è¡Œä¸­ (Phase 1-5 å®Œæˆ, 52/52 RPC æ–¹æ³• + ä¾¿æ·æ–¹æ³•å·²å®ç°)
