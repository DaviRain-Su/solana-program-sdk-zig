# Story: v0.2.0 Serialization

> Implement serialization formats used by Solana for transaction and account data encoding

## 目标

Implement the core serialization modules that enable encoding/decoding of Solana data structures for network transmission and storage.

## 验收标准

### short_vec.zig (Short Vector Encoding)

- [x] `ShortU16` type for compact u16 encoding (1-3 bytes)
- [x] `encodeLen()` function to encode length (`encodeU16`)
- [x] `decodeLen()` function to decode length (`decodeU16Len`)
- [x] `ShortVec` wrapper for vectors with compact length prefix
- [x] Unit tests matching Rust implementation (7 tests)
- [x] Memory safety guarantees (no allocations in encode/decode)

### borsh.zig (Borsh Serialization)

- [x] `serialize()` function for encoding
- [x] `deserialize()` function for decoding  
- [x] Support for primitive types (u8, u16, u32, u64, i8, i16, i32, i64, bool, f32, f64)
- [x] Support for arrays and slices
- [x] Support for optional types
- [x] Support for structs (compile-time reflection)
- [x] Support for enums and tagged unions
- [x] `serializedSize()` for size calculation
- [x] `serializeAlloc()` for allocating serialization
- [x] Unit tests (22 tests)

### bincode.zig (Bincode Serialization)

- [x] `serialize()` function for encoding
- [x] `deserialize()` function for decoding
- [x] Support for primitive types (u8-u128, i8-i128, f32, f64, bool)
- [x] Support for arrays and slices (u64 length prefix)
- [x] Support for optionals, structs, enums (u32 tag), tagged unions
- [x] Little-endian encoding
- [x] NaN allowed (unlike borsh)
- [x] Unit tests (22 tests)

### serialize_utils.zig (Utilities)

- [ ] Common serialization helpers
- [ ] Buffer management utilities
- [ ] Integration with short_vec

### Integration

- [x] root.zig 导出 (short_vec, borsh, bincode modules)
- [ ] 文档更新
- [x] 测试通过 (short_vec: 7, borsh: 22, bincode: 22 = 51 tests)

## 完成状态

- 开始日期: 2026-01-03
- 预计完成: 2026-01-05
- 当前状态: ⏳ 进行中
- 阻塞因素: None

## 设计决策

### Encoding Strategy
- Use little-endian byte order (matching Rust/Solana convention)
- Minimize allocations in hot paths
- Support both allocating and non-allocating APIs

### API Design
- Mirror Rust SDK API where practical
- Use Zig idioms for memory management
- Provide type-safe serialization

## 测试策略

1. **Unit Tests**: Each encoding function tested with known values
2. **Roundtrip Tests**: Encode then decode, verify equality
3. **Compatibility Tests**: Verify output matches Rust SDK
4. **Edge Cases**: Empty data, max values, overflow handling
