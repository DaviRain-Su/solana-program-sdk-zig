name: Anchor CI

on:
  push:
    branches: [dev, main]
    paths:
      - "anchor/**"
      - ".github/workflows/anchor-ci.yml"
  pull_request:
    branches: [dev, main]
    paths:
      - "anchor/**"
      - ".github/workflows/anchor-ci.yml"

env:
  SOLANA_ZIG_VERSION: v1.52.0

jobs:
  anchor-test:
    name: Anchor Tests
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4

      - name: Cache solana-zig
        uses: actions/cache@v4
        with:
          path: solana-zig
          key: solana-zig-${{ env.SOLANA_ZIG_VERSION }}-linux

      - name: Install solana-zig
        run: ./install-solana-zig.sh solana-zig

      - name: Test Anchor
        working-directory: anchor
        run: ../solana-zig/zig build test --summary all
